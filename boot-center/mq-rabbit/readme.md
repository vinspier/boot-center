# 消息中间件 - rabbitMQ

## 队列工作模式
https://www.rabbitmq.com/getstarted.html
+ 简单
  + 直怼 队列 
  + 单个消费这
+ 工作模式
  + 直怼 队列
  + 多个消费者
+ 发布订阅
  + 交换机 转发
  + 多队列
+ 路由
  + 交换机 转发
  + 指定 到达队列 路由规则

## 队列类型
+ 普通队列
+ 延时队列（TTL）
  + 指定延迟时间 定时发送
  + 事件发生完成后 指定时间后 执行特殊逻辑
    + 释放订单、自动结算、延迟发送消息
  + 注意：定时任务 会存在间隔问题；并且数据量大的情况 耗查询性能
  + 队列设置TTL 对所有的消息生效 时间较唯一
  + 消息设置TTL 消息量大的情况下 队列中到期的消息也可能会而外存活一段时间
    + 因为RabbitMQ只会检查第一个消息是否过期，而第二个消息的延时时长很短，则第二个消息并不会优先得到执行
    + 解决：
      + 1、可使用插件实现实时延时队列 (通用延时队列) https://www.rabbitmq.com/community-plugins.html
      + 2、java的delayQueue
      + 3、redis的zSet
+ 死信队列
  + 接受 被拒绝、超时、超大小限制
  + 消息不能丢失的要求下 做业务补偿处理
    + 发送消息 通知
    + 入库记录日志